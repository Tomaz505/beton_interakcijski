<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
     <!--   <meta http-equiv="refresh" content="10">  -->
    <title>Analiza betonskega prereza</title>
    <script src="https://cdn.plot.ly/plotly-3.3.1.js"></script>
    <script src="out.js"></script>
    <style> .narrow-text { max-width: 800px; line-height: 1.5; margin-bottom: 1em; } </style>
</head>


<body>



<script>
//<div word-wrap= "break-word"; width= "800px";></div>
</script>

<h2>Analiza betonskega prereza</h2>
<p class = "narrow-text", text-align: "center">
V datoteko in.txt vnesemo željene podatke, kjer se moramo strogo držati predpisane strukture.
Program je napisan v jeziku Fortran zato je potrebno programu povedati koliko vozlišč in obtežnih primerov bomo vnesli, da lahko progra alocira potreben spomin.
Ko smo vnesli željene podatke odpremo datoteko main.exe.
Račun je zelo hiter, zato lahko po tem ko odpremo datoteko osvežimo brskalnik kjer je odprt prikaz.html.
</p>
<h3>Rezultati</h3>
<p class = "narrow-text">
Z klikom na element legente ga odstranimo iz pogleda. Če je rob telesa, ki ga omejuje interakcijki diagram, konveksen je dovolj, da preverimo če projekcije vplivov ležijo znotraj treh projekcije diagrama.
</p>

<div id="chart2" style="width:800px;height:800px;"></div>
<div id="chart" style="width:800px;height:800px;"></div>




<script>
function reshape(arr, rows, cols) {
  if (arr.length !== rows * cols) throw "Size mismatch";
  const result = [];
  for (let r = 0; r < rows; r++) {
    result.push(arr.slice(r * cols, (r + 1) * cols));
  }
  return result;
}

reshape([1,2,3,4,5,6], 2, 3);


function makeTicks(arr,n) {
    const min = Math.min(...arr);
    const max = Math.max(...arr);
    const step = (max - min) / n;
    const ticks = [];
    for (let i = 0; i <= n; i++) {
        ticks.push(min + i * step);}
    return ticks;}
function expandRange(arr, factor = 1.1) {
    const min = Math.min(...arr);
    const max = Math.max(...arr);
    const center = (min + max) / 2;
    const half = (max - min) / 2 * factor;
    return [center - half, center + half];
}



const lines = sec_coor.trim().split(/\r?\n/);
const xData = [];
const yData = [];
lines.forEach(line => {
    const parts = line.trim().split(/\s+/);
    if (parts.length === 2) {
        xData.push(parseFloat(parts[0]));
        yData.push(parseFloat(parts[1]));
    }
});

const lines_a = a_coor.trim().split(/\r?\n/);
const xData_a = [];
const yData_a = [];
const aData_a = [];
lines_a.forEach(line => {
    const parts = line.trim().split(/\s+/);
    if (parts.length === 3) {
        xData_a.push(parseFloat(parts[0]));
        yData_a.push(parseFloat(parts[1]));
        aData_a.push(parseFloat(parts[2]));
        }
});

const lines_ed = load_c.trim().split(/\r?\n/);
const edData_N = [];
const edData_Mx = [];
const edData_My = [];
lines_ed.forEach(line => {
    const parts = line.trim().split(/\s+/);
    if (parts.length === 3) {
        edData_N.push(parseFloat(parts[0]));
        edData_Mx.push(parseFloat(parts[1]));
        edData_My.push(parseFloat(parts[2]));
        }
});

console.log(edData_N)


//Branje podatkov diagrama
const lines_intr = intr.trim().split(/\r?\n/);

let nrdel = [], mrd1el = [], mrd2el = []; let nrdpl = [], mrd1pl = [], mrd2pl = [];

if (analiza == 1 || analiza ==2 ) {


lines_intr.forEach(line => {
    const parts = line.trim().split(/\s+/);
    if (parts.length === 3) {
        nrdel.push(parseFloat(parts[0]));
        mrd1el.push(parseFloat(parts[1]));
        mrd2el.push(parseFloat(parts[2]));

    }
});
} else {

lines_intr.forEach(line => {
    const parts = line.trim().split(/\s+/);
    if (parts.length === 6) {
        nrdel.push(parseFloat(parts[0]));
        mrd1el.push(parseFloat(parts[1]));
        mrd2el.push(parseFloat(parts[2]));
        nrdpl.push(parseFloat(parts[3]));
        mrd1pl.push(parseFloat(parts[4]));
        mrd2pl.push(parseFloat(parts[5]));

    }
});
}

// Plotly traces
var trace1 = {
    x: xData,
    y: yData,
    mode: 'lines',
    name: 'C',
    line: { width: 2, color: 'black' },
    //showlegend:false
};
var trace4 = {
    x: xData_a,
    y: yData_a,
    mode: 'markers',
    type: 'scatter',
    name : 'S',
    text: aData_a,
    marker: { size: aData_a.map(v => v * 5) ,color:'purple',opacity: 0.5},
    //showlegend:false
};




let lab = "a"
var trace2 = {x:[0,1],y:[1,0]};
var  trace3 = {x:[0,1],y:[1,0]};

var trace5 = {
    x: edData_Mx,
    y: edData_My,
    z: edData_N,
    xaxis: 'x2',
    yaxis: 'y2',
    zaxis: 'z2',
    mode: 'markers',
    type: 'scatter3d',
    name : 'Ed',
    marker: { size: 2.2 ,color:'#df1c44',opacity: 0.8,sizerel: 3,symbol: 'x'},
    showlegend : true,
    projection:{x:{show: true, opacity: 0.8},y:{show: true, opacity: 0.8},z:{show: true, opacity: 0.8}},
};


if (analiza == 1 || analiza ==2) {
if ( analiza == 1){
 lab = "MSU";
} else {
 lab = "MSN";};

trace2 = {
    x: mrd1el,
    y: mrd2el,
    z: nrdel,
    xaxis: 'x2',
    yaxis: 'y2',
    zaxis: 'z2',
    mode: 'markers',
    type: 'scatter3d',
    opacity: 0.4,
    name : lab,
    marker: { size: 1.75 ,color:'green',opacity: 0.2,sizerel: 3},
    showlegend : true,
    projection:{x:{show: true, opacity: 0.1},y:{show: true, opacity: 0.1},z:{show: true, opacity: 0.1}},
};

var layout2 = {
    scene: {
        xaxis: {range: expandRange(mrd1el,factor = 1.4),
            tickvals: makeTicks(mrd1el,4),
            ticktext: makeTicks(mrd1el,4).map(v => v.toFixed(2)),
            scaleancor: 'y', scaleratio: 1
        },
        yaxis: {range: expandRange(mrd2el,factor = 1.4),
            tickvals: makeTicks(mrd2el,4),
            ticktext: makeTicks(mrd2el,4).map(v => v.toFixed(2)),
            scaleratio: 1,
        },
        zaxis: {range: expandRange(nrdel,factor = 1.4),
            tickvals: makeTicks(nrdel,4),
            ticktext: makeTicks(nrdel,4).map(v => v.toFixed(2)),
            scaleancor: 'y', scaleratio: 1
        }
    },
    updatemenus: [{
        type: "buttons",
        direction: "left",
        x: 0.75,
        y: 1.15,
        buttons: [
            {
                label: "Diagram+Projekcije",
                method: "restyle",
                args: [
                    { "marker.opacity": [0.1,0.6], "projection.x.opacity": [0.07,0.6], "projection.y.opacity": [0.07,0.6], "projection.z.opacity": [0.07,0.6]},
                    [0,1]
                ]
            },
            {
                label: "Projekcije",
                method: "restyle",
                args: [

                    {"marker.opacity": 0, "projection.x.opacity": [0.12,0.6], "projection.y.opacity": [0.12,0.6], "projection.z.opacity": [0.12,0.6]},
                    [0,1]
                ]
            },
            {
                label: "Diagram",
                method: "restyle",
                args: [
                    {"marker.opacity": [0.3,0.6], "projection.x.opacity": 0, "projection.y.opacity": 0, "projection.z.opacity": 0},
                    [0,1]
                ]
            }
        ]
    }]
};
} else {

var trace2 = {
    x: mrd2el,
    y: mrd1el,
    z: nrdel,
    xaxis: 'x2',
    yaxis: 'y2',
    zaxis: 'z2',
    mode: 'markers',
    type: 'scatter3d',
    name : "El",
    marker: { size: 1.25 ,color:'skyblue',opacity: 0.3,sizeref: 3},
    showlegend : true,
    projection:{x:{show: true, opacity: 0.07},y:{show: true, opacity: 0.07},z:{show: true, opacity: 0.07}},
    layout: {xaxis2: {scaleanchor: 'y',scaleratio:1},zaxis2:{scaleratio:1}}
};

var trace3 = {
    x: mrd1pl,
    y: mrd2pl,
    z: nrdpl,
    xaxis: 'x2',
    yaxis: 'y2',
    zaxis: 'z2',
    mode: 'markers',
    type: 'scatter3d',
    name : "Pl",
    marker: { size: 1.25 ,color:'orange',opacity: 0.3,sizeref:3.5},
    showlegend : true,
    projection:{x:{show: true, opacity: 0.07},y:{show: true, opacity: 0.07},z:{show: true, opacity: 0.07}},
    layout: {xaxis2: {scaleanchor: 'y',scaleratio:1},zaxis2:{scaleratio:1}}
};

var layout2 = {
    scene: {
        xaxis: {range: expandRange(mrd1pl,factor = 1.4),
            tickvals: makeTicks(mrd1pl,4),
            ticktext: makeTicks(mrd1pl,4).map(v => v.toFixed(2)),
        },
        yaxis: {range: expandRange(mrd2pl,factor = 1.4),
            tickvals: makeTicks(mrd2pl,4),
            ticktext: makeTicks(mrd2pl,4).map(v => v.toFixed(2)),

            },
        zaxis: {range: expandRange(nrdpl,factor = 1.4),
            tickvals: makeTicks(nrdpl,4),
            ticktext: makeTicks(nrdpl,4).map(v => v.toFixed(2)),

        },
        aspectratio: {
        x: 1.6,   // make x-axis longer or shorter
        y: 1.6, // stretch y-axis
        z: 1  // compress z-axis
    }
    },
    legend: {itemsizing: "constant"},

    updatemenus: [{
        type: "buttons",
        direction: "left",
        x: 0.75,
        y: 1.15,
        buttons: [
            {  label: "Diagram+Projekcije", method: "restyle", args: [
                    {
                        "marker.opacity": 0.1,
                        "projection.x.opacity": 0.07,
                        "projection.y.opacity": 0.07,
                        "projection.z.opacity": 0.07,
                    },
                    [0,1,2]
                ]
            },
            {
                label: "Projekcije",
                method: "restyle",
                args: [
                    {
                        "marker.opacity": 0,
                        "projection.x.opacity": 0.12,
                        "projection.y.opacity": 0.12,
                        "projection.z.opacity": 0.12
                    },
                    [0,1,2]
                ]
            },
            {
                label: "Diagram",
                method: "restyle",
                args: [
                    {   "marker.opacity": 0.3,
                        "projection.x.opacity": 0.0,
                        "projection.y.opacity": 0.0,
                        "projection.z.opacity": 0.0},
                    [0,1,2]
                ]
            }
        ]
    }]
};


}



var layout = {
    xaxis: { title: 'x',scaleratio: 1,scaleanchor: 'y', tickmode: 'array', tickvals: xData.concat(xData_a),tickangle: -90 },
    yaxis: { title: 'y',scaleratio: 1,  tickmode: 'array', tickvals: yData.concat(yData_a) },
    margin:{ t: 20 },
    //grid:  {rows:1,columns:2, pattern: 'independent'}
};



// Render
Plotly.newPlot('chart',[trace1,trace4], layout);
if (analiza ==2 || analiza == 1){
Plotly.newPlot('chart2', [trace2,trace5],layout2);
} else {
Plotly.newPlot('chart2', [trace2,trace3,trace5],layout2);

}

</script>



</body>
</html>
